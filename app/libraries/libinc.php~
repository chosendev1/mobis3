<?php

class libinc {
	function getItemById($table,$id,$idField,$dispField){
		$ci =& get_instance();
		$query =$ci->db->query("select ".$dispField." from ".$table." where ".$idField."='".$id."' LIMIT 1");
		if($query->num_rows() > 0){
			foreach($query->result() as $row)
				$displayItem = $row->$dispField;
			return $displayItem;
		}	
			return 0;
	 }


	function getUserGroupRightIds(){
			$ci =& get_instance();
			$sth = $ci->db->query("SELECT * FROM userGroupRights WHERE groupId=?", array(CAP_Session::get("groupId")));
			if($sth->num_rows() > 0)
				return $sth;
			return false;
		}

	function getSubMenus($parentId=0){
			$ci =& get_instance();
			$sth = $parentId==0 ? $ci->db->query("SELECT * FROM menus order by parentId") : $ci->db->query("SELECT * FROM menus WHERE parentId='".$parentId."' order by parentId");
			//return "Error";
			if($sth->num_rows() > 0)
				return $sth;
			return "Error";
	}

	function hasChildren($parentId){
		$ci =& get_instance();
		$sth = $ci->db->query("SELECT * FROM menus WHERE parentId='".$parentId."' order by parentId");
		if($sth->num_rows() > 0)
			return 1;
		return 0;
	}
	
	function getUserMainMenu($userId){
			$ci =& get_instance();
			$ids = libinc::getUserGroupRightIds();
			$menuIds = '0';
			if($ids === false)
				;
			else{
				foreach($ids->result() as $id)
					$menuIds = $menuIds == '' || $menuIds == '0' ? $id->menuId : $menuIds.','.$id->menuId;
			}
			//return $menuIds;
			$sth = $ci->db->query("SELECT * FROM menus WHERE menuId in(".$menuIds.") AND parentId=0");
			if($sth->num_rows() > 0)
				return $sth;
			return "Error";
	}
	
	function getCountry($country=""){
		$content = "";
		$countries = array(
		"Afghanistan"  => "Afghanistan ",
                 "Albania"  => "Albania ",
                 "Algeria"  => "Algeria ",
                 "Andorra"  => "Andorra ",
                 "Anguila"  => "Anguila ",
                 "Antarctica"  => "Antarctica ",
                 "Antigua and Barbuda"  => "Antigua and Barbuda ",
                 "Argentina"  => "Argentina ",
                 "Armenia "  => "Armenia  ",
                 "Aruba"  => "Aruba ",
                 "Australia"  => "Australia ",
                 "Austria"  => "Austria ",
                 "Azerbaidjan"  => "Azerbaidjan ",
                 "Bahamas"  => "Bahamas ",
                 "Bahrain"  => "Bahrain ",
                 "Bangladesh"  => "Bangladesh ",
                 "Barbados"  => "Barbados ",
                 "Belarus"  => "Belarus ",
                 "Belgium"  => "Belgium ",
                 "Belize"  => "Belize ",
                 "Bermuda"  => "Bermuda ",
                 "Bhutan"  => "Bhutan ",
                 "Bolivia"  => "Bolivia ",
                 "Bosnia and Herzegovina"  => "Bosnia and Herzegovina ",
                 "Brazil"  => "Brazil ",
                 "Brunei"  => "Brunei ",
                 "Bulgaria"  => "Bulgaria ",
		   "Burundi"  => "Burundi",
                 "Cambodia"  => "Cambodia ",
                 "Canada"  => "Canada ",
                 "Cape Verde"  => "Cape Verde ",
                 "Cayman Islands"  => "Cayman Islands ",
                 "Chile"  => "Chile ",
                 "China"  => "China ",
                 "Christmans Islands"  => "Christmans Islands ",
                 "Cocos Island"  => "Cocos Island ",
                 "Colombia"  => "Colombia ",
                 "Cook Islands"  => "Cook Islands ",
                 "Costa Rica"  => "Costa Rica ",
                 "Croatia"  => "Croatia ",
                 "Cuba"  => "Cuba ",
                 "Cyprus"  => "Cyprus ",
                 "Czech Republic"  => "Czech Republic ",
                 "Denmark"  => "Denmark ",
                 "Dominica"  => "Dominica ",
                 "Dominican Republic"  => "Dominican Republic ",
                 "Ecuador"  => "Ecuador ",
                 "Egypt"  => "Egypt ",
                 "El Salvador"  => "El Salvador ",
                 "Estonia"  => "Estonia ",
                 "Falkland Islands"  => "Falkland Islands ",
                 "Faroe Islands"  => "Faroe Islands ",
                 "Fiji"  => "Fiji ",
                 "Finland"  => "Finland ",
                 "France"  => "France ",
                 "French Guyana"  => "French Guyana ",
                 "French Polynesia"  => "French Polynesia ",
                 "Gabon"  => "Gabon ",
                 "Germany"  => "Germany ",
                 "Gibraltar"  => "Gibraltar ",
                 "Georgia"  => "Georgia ",
                 "Greece"  => "Greece ",
                 "Greenland"  => "Greenland ",
                 "Grenada"  => "Grenada ",
                 "Guadeloupe"  => "Guadeloupe ",
                 "Guatemala"  => "Guatemala ",
                 "Guinea-Bissau"  => "Guinea-Bissau ",
                 "Guinea"  => "Guinea ",
                 "Haiti"  => "Haiti ",
                 "Honduras"  => "Honduras ",
                 "Hong Kong"  => "Hong Kong ",
                 "Hungary"  => "Hungary ",
                 "Iceland"  => "Iceland ",
                 "India"  => "India ",
                 "Indonesia"  => "Indonesia ",
				 "Iran"  => "Iran ",
				 "Iraq"  => "Iraq ",
                 "Ireland"  => "Ireland ",
                 "Israel"  => "Israel ",
                 "Italy"  => "Italy ",
                 "Jamaica"  => "Jamaica ",
                 "Japan"  => "Japan ",
                 "Jordan"  => "Jordan ",
                 "Kazakhstan"  => "Kazakhstan ",
                 "Kenya"  => "Kenya ",
                 "Kiribati "  => "Kiribati  ",
                 "Kuwait"  => "Kuwait ",
                 "Kyrgyzstan"  => "Kyrgyzstan ",
                 "Lao People\'s Democratic Republic"  => "Lao People's 
                Democratic Republic ",
                 "Latvia"  => "Latvia ",
                 "Lebanon"  => "Lebanon ",
                 "Liechtenstein"  => "Liechtenstein ",
                 "Lithuania"  => "Lithuania ",
                 "Luxembourg"  => "Luxembourg ",
                 "Macedonia"  => "Macedonia ",
                 "Madagascar"  => "Madagascar ",
                 "Malawi"  => "Malawi ",
                 "Malaysia "  => "Malaysia  ",
                 "Maldives"  => "Maldives ",
                 "Mali"  => "Mali ",
                 "Malta"  => "Malta ",
                 "Marocco"  => "Marocco ",
                 "Marshall Islands"  => "Marshall Islands ",
                 "Mauritania"  => "Mauritania ",
                 "Mauritius"  => "Mauritius ",
                 "Mexico"  => "Mexico ",
                 "Micronesia"  => "Micronesia ",
                 "Moldavia"  => "Moldavia ",
                 "Monaco"  => "Monaco ",
                 "Mongolia"  => "Mongolia ",
                 "Myanmar"  => "Myanmar ",
                 "Nauru"  => "Nauru ",
                 "Nepal"  => "Nepal ",
                 "Netherlands Antilles"  => "Netherlands Antilles ",
                 "Netherlands"  => "Netherlands ",
                 "New Zealand"  => "New Zealand ",
                 "Niue"  => "Niue ",
                 "North Korea"  => "North Korea ",
                 "Norway"  => "Norway ",
                 "Oman"  => "Oman ",
                 "Pakistan"  => "Pakistan ",
                 "Palau"  => "Palau ",
                 "Panama"  => "Panama ",
                 "Papua New Guinea"  => "Papua New Guinea ",
                 "Paraguay"  => "Paraguay ",
                 "Peru "  => "Peru  ",
                 "Philippines"  => "Philippines ",
                 "Poland"  => "Poland ",
                 "Portugal "  => "Portugal  ",
                 "Puerto Rico"  => "Puerto Rico ",
                 "Qatar"  => "Qatar ",
                 "Republic of Korea Reunion"  => "Republic of Korea Reunion ",
                 "Romania"  => "Romania ",
                 "Russia"  => "Russia ",
		   "Rwanda"  => "Rwanda",
                 "Saint Helena"  => "Saint Helena ",
                 "Saint kitts and nevis"  => "Saint kitts and nevis ",
                 "Saint Lucia"  => "Saint Lucia ",
                 "Samoa"  => "Samoa ",
                 "San Marino"  => "San Marino ",
                 "Saudi Arabia"  => "Saudi Arabia ",
                 "Seychelles"  => "Seychelles ",
                 "Singapore"  => "Singapore ",
                 "Slovakia"  => "Slovakia ",
                 "Slovenia"  => "Slovenia ",
                 "Solomon Islands"  => "Solomon Islands ",
                 "South Africa"  => "South Africa ",
                 "South Sudan"  => "South Sudan",
                 "Spain"  => "Spain ",
                 "Sri Lanka"  => "Sri Lanka ",
                 "St.Pierre and Miquelon"  => "St.Pierre and Miquelon ",
                 "St.Vincent and the Grenadines"  => "St.Vincent and the 
                Grenadines ",
                 "Sudan"	=>	"Sudan",
                 "Sweden"  => "Sweden ",
                 "Switzerland"  => "Switzerland ",
                 "Syria"  => "Syria ",
                 "Taiwan "  => "Taiwan  ",
                 "Tajikistan"  => "Tajikistan ",
                 "Tanzania"	=>	"Tanzania",
                 "Thailand"  => "Thailand ",
                 "Trinidad and Tobago"  => "Trinidad and Tobago ",
                 "Turkey"  => "Turkey ",
                 "Turkmenistan"  => "Turkmenistan ",
                 "Turks and Caicos Islands"  => "Turks and Caicos Islands ",
                 "Uganda"  => "Uganda ",
                 "Ukraine"  => "Ukraine ",
                 "UAE"  => "UAE ",
                 "UK"  => "UK ",
                 "USA"  => "USA ",
                 "Uruguay"  => "Uruguay ",
                 "Uzbekistan"  => "Uzbekistan ",
                 "Vanuatu"  => "Vanuatu ",
                 "Vatican City"  => "Vatican City ",
                 "Vietnam"  => "Vietnam ",
                 "Virgin Islands (GB)"  => "Virgin Islands (GB) ",
                 "Virgin Islands (U.S.) "  => "Virgin Islands (U.S.)  ",
                 "Wallis and Futuna Islands"  => "Wallis and Futuna Islands ",
                 "Yemen"  => "Yemen ",
                 "Yugoslavia"  => "Yugoslavia "	
				);
		
                /*foreach($countrys as $key => $val){
                	$sel = strtolower($country) == strtolower($key) ? "SELECTED" : NULL;
			$content .="<option value='".$key."' ".$sel.">".$val."</option>";
		}
		return $content;*/
		return $countries;	
	}
	
	public function getCountryData($parentId=0){
		$ci =& get_instance();
		$sth = $ci->db->query("Select countryHierachyId,hierachyName from  countrydata where parentId=".$parentId);
		$buf = array();
		if($sth->num_rows() > 0){
			foreach($sth->result() as $res)
				$buf[$res->countryHierachyId] = $res->hierachyName;
		}
		return $buf;
	}
	
	function getTableItems($table,$id,$disp, $itemId=""){
		$ci =& get_instance();
		$sth = $ci->db->query("select $id,$disp from $table");
		$content = array();
		if($sth->num_rows()>0){
			foreach($sth->result() as $res){
				$content[$res->$id] = $res->$disp;
			}
		return $content;
		}	
	}
	
	function genderSelect2($type=""){
		$content = "";
		$types = array(
				"M"  => "Male",
                "F"  => "Female");

		foreach($types as $key => $val){
                	$sel = strtolower($type) == strtolower($key) ? "SELECTED" : NULL;
			$content .="<option value='".$key."' ".$sel.">".$val."</option>";
		}
		return $content;	
	}
	
	function getItem($table,$id,$disp, $itemId=""){
		$ci =& get_instance();
		$co = $ci->db->query("select $id,$disp from $table");
		$content = "";
		if($co->num_rows()>0){
			foreach($co->result() as $row){
				$sel = $itemId == $row->$id ? "SELECTED" : NULL; 
				$content .="<option value='".$row->$id."' ".$sel.">".$row->$disp."</option>";
			}
		return $content;
		}
	
	}
	
	function getGroups($group=""){
		$ci =& get_instance();
		$groups = $ci->db->query("select * from groups");
		$data = "";
		if($groups->num_rows()>0){
			$data = "<option value=''>--Select group --</option>";
			foreach($groups->result() as $row){
				$selected = strtolower($row->group_name) == strtolower($group) ?"SELECTED" : NULL;
				$data = $data=="" ? "<option value='".$row->id."' ".$selected.">".$row->group_name."</option>" :
				$data .= "<option value='".$row->id."' ".$selected.">".$row->group_name."</option>";
			}
		}
		return $data;
	}
	
	function isCompanyUser(){
		$ci =& get_instance();
		CAP_Session::init();
		$co = $ci->db->query("select companyId from users where userId=".CAP_Session::get('userId'));
		if($co->num_rows() > 0)
			 return $co->row()->companyId <> "";
		return false;
	}
	
	function getCompanyId(){
		$ci =& get_instance();
		CAP_Session::init();
		$co = $ci->db->query("select companyId from users where userId=".CAP_Session::get('userId'));
		if($co->num_rows() > 0)
			 return $co->row()->companyId;
		return 0;
	}
	
	function getCreditOfficers(){
		$ci =& get_instance();
		$sth = $ci->db->query("SELECT * FROM employees WHERE roleId=(SELECT roleId FROM roles WHERE roleName='Credit Officer')");
		return $sth;
	}
	
	function IdentityTypes($type=""){
			$content = "";
			$types = array(
					"Identity"  => "Identity",
					"Passport"  => "Passport",
					"Lessez-passer"  => "Lessez-passer");

			foreach($types as $key => $val){
						$sel = strtolower($type) == strtolower($key) ? "SELECTED" : NULL;
				$content .="<option value='".$key."' ".$sel.">".$val."</option>";
			}
			return $content;	
	}
	
}
?>
